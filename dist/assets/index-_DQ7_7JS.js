import{c as G,Q as v,u as $,J as Y,h as z,i as B,K as X,L as K,f as w,M as J,R as I,r as F,N as W,O as Z,T as ee,j as e,B as y,V as se,C as A,b as T,d as D,e as L,W as te}from"./index-DFBcCm7V.js";import{c as Q,b as E,a as h,V as j,d as ae,e as re,u as ne,F as ie,f as ce,E as R}from"./validation-DsEQZqBB.js";import{M as V,g as _}from"./messages-keBJKTKK.js";import{B as le,a as M}from"./breadcrumb-HxzqXsx2.js";import{I as O}from"./input-Cn8rvVGd.js";import{L as N}from"./label-DDo3gBiT.js";import{T as P,C as de,H as oe}from"./checkbox-DO8Z6D45.js";import{T as ue,S as me}from"./target-audience-selector-BHqQm9te.js";import{S as he,a as pe,b as xe,c as ge,d as k}from"./select-CERIiCGz.js";import{T as ve,P as U}from"./trash-2-st2Kg0im.js";import{X as je}from"./x-DKR4CodG.js";import"./chevron-right-BpkOYE9z.js";import"./index-DvoRuxMr.js";import"./index-DSUgCejY.js";const ye=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],fe=G("grip-vertical",ye),Ne=Q({id:h().required(),type:h().oneOf(Object.values(v)).required(),text:h().required(j.required).max(500,j.maxLength(500)),options:E().when("type",{is:v.MULTIPLE_CHOICE,then:l=>l.min(2,"At least 2 options required").required(),otherwise:l=>l.notRequired()}),required:re().required(),order:ae().required()}),Se=Q({title:h().required(j.required).max(200,j.maxLength(200)),purpose:h().required(j.required).max(1e3,j.maxLength(1e3)),targetAudience:Q({teams:E().of(h().required()).optional(),departments:E().of(h().required()).optional(),roles:E().of(h().required()).optional(),locations:E().of(h().required()).optional()}).required().test("has-audience","At least one target audience group must be selected",function(l){if(!l)return!1;const{teams:t,departments:m,roles:n,locations:f}=l;return(t?.length||0)+(m?.length||0)+(n?.length||0)+(f?.length||0)>0}),openDate:h().required(j.required),closeDate:h().required(j.required).test("is-after-open","Close date must be after open date",function(l){const{openDate:t}=this.parent;return!l||!t?!0:new Date(l)>new Date(t)}),questions:E().of(Ne).min(1,"At least one question is required").required()}),Ce={title:"",purpose:"",targetAudience:{teams:[],departments:[],roles:[],locations:[]},openDate:"",closeDate:"",questions:[]},Ee=()=>{const l=$(),{id:t}=Y(),m=z(),n=B(X),f=B(a=>a.survey.isLoading),i=ne({initialValues:Ce,validationSchema:Se,onSubmit:async a=>{try{t?(await m(K({id:t,updates:a})).unwrap(),w.success(V.SUCCESS.UPDATED)):(await m(J(a)).unwrap(),w.success(V.SUCCESS.CREATED)),l(I.SURVEYS.LIST)}catch(o){w.error(_(o,"Failed to save survey"))}},enableReinitialize:!0});return F.useEffect(()=>{t&&m(W(t))},[t,m]),F.useEffect(()=>{if(t&&n&&n.id===t){const a=o=>{if(!o)return"";try{const r=new Date(o),u=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0"),d=String(r.getHours()).padStart(2,"0"),p=String(r.getMinutes()).padStart(2,"0");return`${u}-${s}-${c}T${d}:${p}`}catch{return o}};i.setValues({title:n.title,purpose:n.purpose,targetAudience:n.targetAudience,openDate:a(n.openDate),closeDate:a(n.closeDate),questions:n.questions})}},[t,n]),{formik:i,isLoading:f,isEditMode:!!t,handleAddQuestion:()=>{const a={id:`question_${Date.now()}`,type:"short_text",text:"",required:!1,order:i.values.questions.length};i.setFieldValue("questions",[...i.values.questions,a])},handleRemoveQuestion:a=>{const r=i.values.questions.filter(u=>u.id!==a).map((u,s)=>({...u,order:s}));i.setFieldValue("questions",r)},handleUpdateQuestion:(a,o)=>{const r=i.values.questions.map(u=>u.id===a?{...u,...o}:u);i.setFieldValue("questions",r)},handleReorderQuestions:(a,o)=>{const r=[...i.values.questions],[u]=r.splice(a,1);r.splice(o,0,u);const s=r.map((c,d)=>({...c,order:d}));i.setFieldValue("questions",s)},handleSaveAsTemplate:async()=>{const a=prompt("Enter template name:");if(!a||!a.trim())return;const o=prompt("Enter template description:")||"";try{await m(Z({name:a.trim(),description:o.trim(),category:ee.TRAINING_FEEDBACK,questions:i.values.questions,targetAudience:i.values.targetAudience})).unwrap(),w.success("Template saved successfully")}catch(r){w.error(_(r,"Failed to save template"))}}}};function be({questions:l,onAdd:t,onRemove:m,onUpdate:n,onReorder:f,errors:i,touched:q}){const[S,C]=F.useState(null),x=s=>{C(s)},g=(s,c)=>{s.preventDefault(),!(S===null||S===c)&&([...l],f(S,c),C(c))},a=()=>{C(null)},o=(s,c=[])=>{n(s,{options:[...c,""]})},r=(s,c,d,p)=>{const b=[...p];b[c]=d,n(s,{options:b})},u=(s,c,d)=>{const p=d.filter((b,H)=>H!==c);n(s,{options:p})};return e.jsxs("div",{className:"space-y-4",children:[l.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"No questions yet. Add your first question to get started."})}),l.map((s,c)=>e.jsx("div",{draggable:!0,onDragStart:()=>x(c),onDragOver:d=>g(d,c),onDragEnd:a,className:"rounded-lg p-4 bg-gray-50 hover:bg-gray-100 transition-colors cursor-move shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-2 cursor-grab active:cursor-grabbing",children:e.jsx(fe,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:["Question ",c+1]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{value:s.type,onValueChange:d=>n(s.id,{type:d,options:d===v.MULTIPLE_CHOICE?["",""]:void 0}),children:[e.jsx(pe,{className:"w-40",children:e.jsx(xe,{placeholder:"Select type"})}),e.jsxs(ge,{children:[e.jsx(k,{value:v.MULTIPLE_CHOICE,children:"Multiple Choice"}),e.jsx(k,{value:v.RATING_SCALE,children:"Rating Scale"}),e.jsx(k,{value:v.SHORT_TEXT,children:"Short Text"}),e.jsx(k,{value:v.LONG_TEXT,children:"Long Text"})]})]}),e.jsx(y,{type:"button",variant:"ghost",size:"sm",onClick:()=>m(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(ve,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{children:["Question Text ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(P,{value:s.text,onChange:d=>n(s.id,{text:d.target.value}),placeholder:"Enter your question",rows:2}),i?.questions?.[c]?.text&&q?.questions?.[c]?.text&&e.jsx("div",{className:"text-sm text-destructive",children:i.questions[c].text})]}),s.type===v.MULTIPLE_CHOICE&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Options"}),s.options?.map((d,p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:d,onChange:b=>r(s.id,p,b.target.value,s.options||[]),placeholder:`Option ${p+1}`,className:"flex-1"}),s.options&&s.options.length>2&&e.jsx(y,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(s.id,p,s.options||[]),children:e.jsx(je,{className:"w-4 h-4"})})]},p)),e.jsxs(y,{type:"button",variant:"outline",size:"sm",onClick:()=>o(s.id,s.options),className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Add Option"]}),i?.questions?.[c]?.options&&e.jsx("div",{className:"text-sm text-destructive",children:i.questions[c].options})]}),s.type===v.RATING_SCALE&&e.jsx("div",{className:"text-sm text-gray-500 bg-blue-50 p-3 rounded",children:"Rating scale: 1 (Lowest) to 5 (Highest)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{id:`required-${s.id}`,checked:s.required,onCheckedChange:d=>n(s.id,{required:d===!0})}),e.jsx(N,{htmlFor:`required-${s.id}`,className:"font-normal cursor-pointer",children:"Required question"}),e.jsx(oe,{content:"Required questions must be answered before the survey can be submitted."})]})]})]})},s.id)),e.jsxs(y,{type:"button",variant:"outline",onClick:t,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Add Question"]}),i?.questions&&typeof i.questions=="string"&&e.jsx("div",{className:"text-sm text-destructive",children:i.questions})]})}function we(){return e.jsxs("div",{className:"space-y-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-24 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})}function Me(){const l=$(),{formik:t,isLoading:m,isEditMode:n,handleAddQuestion:f,handleRemoveQuestion:i,handleUpdateQuestion:q,handleReorderQuestions:S,handleSaveAsTemplate:C}=Ee(),{values:x,errors:g,touched:a,isSubmitting:o}=t;return m&&n?e.jsx(we,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(le,{children:[e.jsx(M,{children:e.jsx("button",{onClick:()=>l(I.SURVEYS.LIST),className:"text-primary hover:underline",children:"Surveys"})}),e.jsx(M,{isCurrentPage:!0,children:n?"Edit Survey":"Create Survey"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent",children:n?"Edit Survey":"Create New Survey"}),e.jsx("p",{className:"text-gray-600 mt-1",children:n?"Update your survey details and questions":"Build a new survey to collect feedback from your team"})]}),e.jsxs(y,{variant:"outline",onClick:()=>l(I.SURVEYS.LIST),className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Back"]})]}),e.jsx(ie,{value:t,children:e.jsxs(ce,{className:"space-y-6",children:[e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(D,{children:"Basic Information"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"title",children:["Survey Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"title",name:"title",value:x.title,onChange:t.handleChange,onBlur:t.handleBlur,placeholder:"Enter survey title",className:g.title&&a.title?"shadow-md shadow-destructive/50":""}),e.jsx(R,{name:"title",children:r=>e.jsx("div",{className:"text-sm text-destructive flex items-center gap-1",children:e.jsx("span",{children:r})})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"purpose",children:["Purpose ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(P,{id:"purpose",name:"purpose",value:x.purpose,onChange:t.handleChange,onBlur:t.handleBlur,placeholder:"Describe the purpose of this survey",rows:4,className:g.purpose&&a.purpose?"shadow-md shadow-destructive/50":""}),e.jsx(R,{name:"purpose",children:r=>e.jsx("div",{className:"text-sm text-destructive flex items-center gap-1",children:e.jsx("span",{children:r})})})]})]})]}),e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(D,{children:"Target Audience"})}),e.jsx(L,{children:e.jsx(ue,{value:x.targetAudience,onChange:r=>t.setFieldValue("targetAudience",r),errors:g.targetAudience,touched:a.targetAudience})})]}),e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(D,{children:"Schedule"})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"openDate",children:["Open Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"openDate",name:"openDate",type:"datetime-local",value:x.openDate,onChange:t.handleChange,onBlur:t.handleBlur,className:g.openDate&&a.openDate?"shadow-md shadow-destructive/50":""}),e.jsx(R,{name:"openDate",children:r=>e.jsx("div",{className:"text-sm text-destructive flex items-center gap-1",children:e.jsx("span",{children:r})})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"closeDate",children:["Close Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"closeDate",name:"closeDate",type:"datetime-local",value:x.closeDate,onChange:t.handleChange,onBlur:t.handleBlur,className:g.closeDate&&a.closeDate?"shadow-md shadow-destructive/50":""}),e.jsx(R,{name:"closeDate",children:r=>e.jsx("div",{className:"text-sm text-destructive flex items-center gap-1",children:e.jsx("span",{children:r})})})]})]})})]}),e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(D,{children:"Questions"})}),e.jsx(L,{children:e.jsx(be,{questions:x.questions,onAdd:f,onRemove:i,onUpdate:q,onReorder:S,errors:g.questions,touched:a.questions})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>l(I.SURVEYS.LIST),children:"Cancel"}),t.values.questions.length>0&&e.jsxs(y,{type:"button",variant:"outline",onClick:C,className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Save as Template"]}),e.jsxs(y,{type:"submit",disabled:o,className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),o?"Saving...":n?"Update Survey":"Create Survey"]})]})]})})]})}export{Me as default};
