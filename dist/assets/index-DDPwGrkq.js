import{u as I,J as V,h as F,i as D,ai as M,aj as P,f as C,ak as R,R as E,r as O,al as H,k as U,o as $,j as e,C as N,e as S,b as y,d as w,V as K,a4 as p,B as k}from"./index-DFBcCm7V.js";import{c as q,a as n,d as L,b as g,V as l,u as G,F as _,f as J,E as v}from"./validation-DsEQZqBB.js";import{M as z,g as Q}from"./messages-keBJKTKK.js";import{B as X,a as B}from"./breadcrumb-HxzqXsx2.js";import{I as f}from"./input-Cn8rvVGd.js";import{L as x}from"./label-DDo3gBiT.js";import{H as Y,C as Z,T as W}from"./checkbox-DO8Z6D45.js";import{T as ee,S as se}from"./target-audience-selector-BHqQm9te.js";import{S as te,a as ae,b as ie,c as re,d as A}from"./select-CERIiCGz.js";import{T as de,P as ce}from"./trash-2-st2Kg0im.js";import"./chevron-right-BpkOYE9z.js";import"./index-DvoRuxMr.js";import"./x-DKR4CodG.js";import"./index-DSUgCejY.js";const ne=q({id:n().required(),description:n().required(l.required).min(3,"Objective description must be at least 3 characters").max(500,l.maxLength(500)),priority:n().oneOf(["high","medium","low"]).required()}),le=q({title:n().required(l.required).max(200,l.maxLength(200)),description:n().required(l.required).max(1e3,l.maxLength(1e3)),topic:n().required(l.required).max(200,l.maxLength(200)),objectives:g().of(ne).min(1,"At least one objective is required").required(),linkedSurveyIds:g().of(n().required()),targetAudience:q({teams:g().of(n().required()),departments:g().of(n().required()),roles:g().of(n().required()),locations:g().of(n().required())}).test("at-least-one-audience","At least one target audience group must be selected.",i=>i.teams&&i.teams.length>0||i.departments&&i.departments.length>0||i.roles&&i.roles.length>0||i.locations&&i.locations.length>0).required(),expectedSize:L().required(l.required).min(1,"Expected size must be at least 1").max(1e3,"Expected size cannot exceed 1000"),scheduledDate:n().required(l.required).test("is-future","Scheduled date must be in the future",function(i){return i?new Date(i)>new Date:!0}),duration:L().required(l.required).min(15,"Duration must be at least 15 minutes").max(480,"Duration cannot exceed 8 hours (480 minutes)"),location:n().max(200,l.maxLength(200))}),oe={title:"",description:"",topic:"",objectives:[],linkedSurveyIds:[],targetAudience:{teams:[],departments:[],roles:[],locations:[]},expectedSize:20,scheduledDate:"",duration:60,location:""},he=i=>{if(!i)return"";const s=new Date(i);return s.setMinutes(s.getMinutes()-s.getTimezoneOffset()),s.toISOString().slice(0,16)},me=()=>{const i=I(),{id:s}=V(),m=F(),d=D(M),j=D(t=>t.workshop.isLoading),r=G({initialValues:oe,validationSchema:le,onSubmit:async t=>{try{const c={title:t.title,description:t.description,topic:t.topic,objectives:t.objectives,linkedSurveyIds:t.linkedSurveyIds||[],targetAudience:t.targetAudience,expectedSize:t.expectedSize,scheduledDate:new Date(t.scheduledDate).toISOString(),duration:t.duration,location:t.location||void 0};s?(await m(P({id:s,updates:c})).unwrap(),C.success(z.SUCCESS.UPDATED)):(await m(R(c)).unwrap(),C.success(z.SUCCESS.CREATED)),i(E.WORKSHOPS.LIST)}catch(c){C.error(Q(c,"Failed to save workshop"))}},enableReinitialize:!0});return O.useEffect(()=>{s&&m(H(s))},[s,m]),O.useEffect(()=>{s&&d&&d.id===s&&r.setValues({title:d.title,description:d.description,topic:d.topic,objectives:d.objectives,linkedSurveyIds:d.linkedSurveyIds,targetAudience:d.targetAudience,expectedSize:d.expectedSize,scheduledDate:he(d.scheduledDate),duration:d.duration,location:d.location||""})},[s,d]),{formik:r,isLoading:j,isEditMode:!!s,handleAddObjective:()=>{const t={id:`objective_${Date.now()}`,description:"",priority:"medium"};r.setFieldValue("objectives",[...r.values.objectives,t])},handleRemoveObjective:t=>{const c=r.values.objectives.filter(a=>a.id!==t);r.setFieldValue("objectives",c)},handleUpdateObjective:(t,c)=>{const a=r.values.objectives.map(u=>u.id===t?{...u,...c}:u);r.setFieldValue("objectives",a)},handleToggleSurvey:t=>{const c=r.values.linkedSurveyIds||[],a=c.includes(t)?c.filter(u=>u!==t):[...c,t];r.setFieldValue("linkedSurveyIds",a)}}};function ue({selectedSurveyIds:i,onToggle:s}){const m=F(),d=D(U);O.useEffect(()=>{m($())},[m]);const j=d.filter(r=>r.status==="published"||r.status==="closed");return j.length===0?e.jsx(N,{children:e.jsx(S,{className:"pt-6",children:e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No published or closed surveys available. Create and publish surveys first to link them to workshops."})})}):e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{children:"Link Surveys"}),e.jsx(Y,{content:"Link surveys that informed this workshop. This helps track which survey insights led to the workshop creation."})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Select surveys that informed this workshop. Only published or closed surveys are available."})]}),e.jsxs(S,{children:[e.jsx("div",{className:"space-y-3",children:j.map(r=>{const b=i.includes(r.id);return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg shadow-sm hover:bg-gray-50 hover:shadow-md transition-shadow",children:[e.jsx(Z,{checked:b,onCheckedChange:()=>s(r.id),className:"mt-1"}),e.jsxs("div",{className:"flex-1",onClick:()=>s(r.id),children:[e.jsx(x,{className:"font-medium cursor-pointer",children:r.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:r.purpose}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-400",children:[e.jsxs("span",{children:[r.questions.length," questions"]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"capitalize",children:r.status})]})]})]},r.id)})}),i.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-4",children:[i.length," survey",i.length!==1?"s":""," selected"]})]})]})}function xe(){return e.jsxs("div",{className:"space-y-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded w-1/2"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-64 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-48 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"})]})]})}function Ee(){const i=I(),{formik:s,isLoading:m,isEditMode:d,handleAddObjective:j,handleRemoveObjective:r,handleUpdateObjective:b,handleToggleSurvey:T}=me(),{values:o,errors:h,touched:t,isSubmitting:c}=s;return m&&d?e.jsx(xe,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(B,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 text-gray-500"}),e.jsx("span",{onClick:()=>i(E.WORKSHOPS.LIST),className:"cursor-pointer hover:text-primary transition-colors",children:"Workshops"})]}),e.jsx(B,{isCurrentPage:!0,children:d?"Edit Workshop":"Create Workshop"})]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:d?"Edit Workshop":"Create New Workshop"}),e.jsx("p",{className:"text-gray-600",children:d?"Modify the details of your workshop.":"Plan a workshop based on survey insights and feedback."}),e.jsx(_,{value:s,children:e.jsxs(J,{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(y,{children:e.jsx(w,{children:"Workshop Details"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"title",children:["Workshop Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(f,{id:"title",name:"title",value:o.title,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"e.g., Agile Training Workshop",className:h.title&&t.title?"shadow-md shadow-destructive/50":""}),e.jsx(v,{name:"title",children:a=>e.jsxs("div",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:a})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"topic",children:["Topic ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(f,{id:"topic",name:"topic",value:o.topic,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"e.g., Agile Methodology",className:h.topic&&t.topic?"shadow-md shadow-destructive/50":""}),e.jsx(v,{name:"topic",children:a=>e.jsxs("div",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:a})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"description",children:["Description ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(W,{id:"description",name:"description",value:o.description,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"Describe the purpose and goals of this workshop",rows:4,className:h.description&&t.description?"shadow-md shadow-destructive/50":""}),e.jsx(v,{name:"description",children:a=>e.jsxs("div",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:a})]})})]})]})]}),e.jsxs(N,{children:[e.jsx(y,{children:e.jsx(w,{children:"Objectives"})}),e.jsxs(S,{children:[e.jsxs("div",{className:"space-y-4",children:[o.objectives.map(a=>e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"text-sm font-medium",children:"Priority:"}),e.jsxs(te,{value:a.priority,onValueChange:u=>b(a.id,{priority:u}),children:[e.jsx(ae,{className:"w-32",children:e.jsx(ie,{})}),e.jsxs(re,{children:[e.jsx(A,{value:"high",children:"High"}),e.jsx(A,{value:"medium",children:"Medium"}),e.jsx(A,{value:"low",children:"Low"})]})]})]}),e.jsx(W,{value:a.description,onChange:u=>b(a.id,{description:u.target.value}),placeholder:"Enter objective description",rows:2})]}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>r(a.id),className:"text-destructive",children:e.jsx(de,{className:"w-4 h-4"})})]},a.id)),e.jsxs(k,{type:"button",variant:"outline",onClick:j,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Objective"]})]}),h.objectives&&typeof h.objectives=="string"&&e.jsxs("div",{className:"text-sm text-destructive mt-2 flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:h.objectives})]})]})]}),e.jsx(ue,{selectedSurveyIds:o.linkedSurveyIds||[],onToggle:T}),e.jsxs(N,{children:[e.jsx(y,{children:e.jsx(w,{children:"Target Audience"})}),e.jsxs(S,{children:[e.jsx(ee,{value:o.targetAudience,onChange:a=>s.setFieldValue("targetAudience",a)}),h.targetAudience&&t.targetAudience&&e.jsxs("div",{className:"text-sm text-destructive mt-2 flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:"Please select at least one target audience group."})]})]})]}),e.jsxs(N,{children:[e.jsx(y,{children:e.jsx(w,{children:"Schedule & Logistics"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"scheduledDate",children:["Scheduled Date & Time ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(f,{id:"scheduledDate",name:"scheduledDate",type:"datetime-local",value:o.scheduledDate,onChange:s.handleChange,onBlur:s.handleBlur,className:h.scheduledDate&&t.scheduledDate?"shadow-md shadow-destructive/50":""}),e.jsx(v,{name:"scheduledDate",children:a=>e.jsxs("div",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:a})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"duration",children:["Duration (minutes) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(f,{id:"duration",name:"duration",type:"number",min:"15",max:"480",value:o.duration,onChange:s.handleChange,onBlur:s.handleBlur,className:h.duration&&t.duration?"shadow-md shadow-destructive/50":""}),e.jsx(v,{name:"duration",children:a=>e.jsxs("div",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:a})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"expectedSize",children:["Expected Size ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(f,{id:"expectedSize",name:"expectedSize",type:"number",min:"1",max:"1000",value:o.expectedSize,onChange:s.handleChange,onBlur:s.handleBlur,className:h.expectedSize&&t.expectedSize?"shadow-md shadow-destructive/50":""}),e.jsx(v,{name:"expectedSize",children:a=>e.jsxs("div",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:a})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"location",children:"Location (optional)"}),e.jsx(f,{id:"location",name:"location",value:o.location,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"e.g., Conference Room A, Online"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>i(E.WORKSHOPS.LIST),disabled:c,children:"Cancel"}),e.jsxs(k,{type:"submit",disabled:c,className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),c?"Saving...":"Save Workshop"]})]})]})})]})}export{Ee as default};
