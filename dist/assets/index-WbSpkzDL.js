import{c as X,J as je,h as Re,i as G,a0 as Ie,K as Ee,r as m,N as Se,f as L,a1 as Ce,w as V,j as e,x as Ae,P as I,z as N,y as T,v as W,a2 as Fe,A as Te,a3 as _e,G as J,Q as C,a4 as O,S as ke,C as A,e as F,b as De,d as Pe,B as Ge}from"./index-DFBcCm7V.js";import{c as Y,g as Le,V as z,a as M,e as Oe,b as Me,u as qe,F as Be,f as Ue,E as Ve}from"./validation-DsEQZqBB.js";import{M as Ke,g as $e}from"./messages-keBJKTKK.js";import{I as B}from"./input-Cn8rvVGd.js";import{L as E}from"./label-DDo3gBiT.js";import{T as He,C as Ye,H as ze}from"./checkbox-DO8Z6D45.js";import{c as Qe,u as Z,a as Xe}from"./index-DvoRuxMr.js";import{C as We}from"./circle-check-big-DUV3782x.js";const Je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ze=X("circle",Je);const es=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Q=X("loader-circle",es),ss=s=>{const t=Y({questionId:M().required(),value:Le().required(z.required)});return Y({answers:Me().of(t).test("required-questions","Please answer all required questions",function(r){if(!r)return!1;const n=r.map(a=>a.questionId);return s.every(a=>n.includes(a))}).min(s.length,"Please answer all required questions").required(),anonymous:Oe().required(),respondentName:M().when("anonymous",{is:!0,then:r=>r.optional(),otherwise:r=>r.optional()}),respondentEmail:M().when("anonymous",{is:!0,then:r=>r.email(z.email.invalid).required("Email is required for anonymous responses"),otherwise:r=>r.optional()})})},rs={answers:[],anonymous:!1,respondentName:"",respondentEmail:""},ts=()=>{const{id:s}=je(),t=Re(),r=G(i=>s?Ie(s)(i):void 0),n=G(Ee),u=G(i=>i.survey.isLoading),[a,d]=m.useState(!1),p=r||n;m.useEffect(()=>{if(s){const i=`survey_submission_${s}`;localStorage.getItem(i)&&d(!0)}},[s]),m.useEffect(()=>{s&&!r&&t(Se(s))},[s,r,t]);const v=p?.status==="published"&&!a&&new Date(p.openDate)<=new Date&&new Date(p.closeDate)>=new Date,x=p?.questions.filter(i=>i.required).map(i=>i.id)||[],l=qe({initialValues:rs,validationSchema:ss(x),onSubmit:async i=>{if(!s||!p){L.error("Survey not found");return}try{const c=p.questions.map(f=>{const o=i.answers.find(g=>g.questionId===f.id);return!o||o.value===void 0||o.value===null||typeof o.value=="string"&&o.value.trim()===""||Array.isArray(o.value)&&o.value.length===0?null:{questionId:f.id,value:o.value}}).filter(f=>f!==null);await t(Ce({surveyId:s,responseData:{...i,answers:c}})).unwrap(),L.success(Ke.SUCCESS.SUBMITTED),d(!0)}catch(c){L.error($e(c,"Failed to submit response"))}},enableReinitialize:!0});return{formik:l,survey:p,isLoading:u,hasSubmitted:a,isAccessible:v,handleAnswerChange:(i,c)=>{const f=l.values.answers.findIndex(g=>g.questionId===i),o={questionId:i,value:c};if(f>=0){const g=[...l.values.answers];g[f]=o,l.setFieldValue("answers",g)}else l.setFieldValue("answers",[...l.values.answers,o])},getAnswerValue:i=>l.values.answers.find(f=>f.questionId===i)?.value}};var q="rovingFocusGroup.onEntryFocus",as={bubbles:!1,cancelable:!0},S="RovingFocusGroup",[U,ee,ns]=Qe(S),[os,se]=V(S,[ns]),[is,cs]=os(S),re=m.forwardRef((s,t)=>e.jsx(U.Provider,{scope:s.__scopeRovingFocusGroup,children:e.jsx(U.Slot,{scope:s.__scopeRovingFocusGroup,children:e.jsx(ls,{...s,ref:t})})}));re.displayName=S;var ls=m.forwardRef((s,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:u=!1,dir:a,currentTabStopId:d,defaultCurrentTabStopId:p,onCurrentTabStopIdChange:v,onEntryFocus:x,preventScrollOnEntryFocus:l=!1,...h}=s,y=m.useRef(null),i=T(t,y),c=Z(a),[f,o]=W({prop:d,defaultProp:p??null,onChange:v,caller:S}),[g,k]=m.useState(!1),w=Fe(x),j=ee(r),D=m.useRef(!1),[ye,$]=m.useState(0);return m.useEffect(()=>{const b=y.current;if(b)return b.addEventListener(q,w),()=>b.removeEventListener(q,w)},[w]),e.jsx(is,{scope:r,orientation:n,dir:c,loop:u,currentTabStopId:f,onItemFocus:m.useCallback(b=>o(b),[o]),onItemShiftTab:m.useCallback(()=>k(!0),[]),onFocusableItemAdd:m.useCallback(()=>$(b=>b+1),[]),onFocusableItemRemove:m.useCallback(()=>$(b=>b-1),[]),children:e.jsx(I.div,{tabIndex:g||ye===0?-1:0,"data-orientation":n,...h,ref:i,style:{outline:"none",...s.style},onMouseDown:N(s.onMouseDown,()=>{D.current=!0}),onFocus:N(s.onFocus,b=>{const ge=!D.current;if(b.target===b.currentTarget&&ge&&!g){const H=new CustomEvent(q,as);if(b.currentTarget.dispatchEvent(H),!H.defaultPrevented){const P=j().filter(R=>R.focusable),be=P.find(R=>R.active),we=P.find(R=>R.id===f),Ne=[be,we,...P].filter(Boolean).map(R=>R.ref.current);ne(Ne,l)}}D.current=!1}),onBlur:N(s.onBlur,()=>k(!1))})})}),te="RovingFocusGroupItem",ae=m.forwardRef((s,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:u=!1,tabStopId:a,children:d,...p}=s,v=Ae(),x=a||v,l=cs(te,r),h=l.currentTabStopId===x,y=ee(r),{onFocusableItemAdd:i,onFocusableItemRemove:c,currentTabStopId:f}=l;return m.useEffect(()=>{if(n)return i(),()=>c()},[n,i,c]),e.jsx(U.ItemSlot,{scope:r,id:x,focusable:n,active:u,children:e.jsx(I.span,{tabIndex:h?0:-1,"data-orientation":l.orientation,...p,ref:t,onMouseDown:N(s.onMouseDown,o=>{n?l.onItemFocus(x):o.preventDefault()}),onFocus:N(s.onFocus,()=>l.onItemFocus(x)),onKeyDown:N(s.onKeyDown,o=>{if(o.key==="Tab"&&o.shiftKey){l.onItemShiftTab();return}if(o.target!==o.currentTarget)return;const g=ms(o,l.orientation,l.dir);if(g!==void 0){if(o.metaKey||o.ctrlKey||o.altKey||o.shiftKey)return;o.preventDefault();let w=y().filter(j=>j.focusable).map(j=>j.ref.current);if(g==="last")w.reverse();else if(g==="prev"||g==="next"){g==="prev"&&w.reverse();const j=w.indexOf(o.currentTarget);w=l.loop?ps(w,j+1):w.slice(j+1)}setTimeout(()=>ne(w))}}),children:typeof d=="function"?d({isCurrentTabStop:h,hasTabStop:f!=null}):d})})});ae.displayName=te;var ds={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function us(s,t){return t!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function ms(s,t,r){const n=us(s.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return ds[n]}function ne(s,t=!1){const r=document.activeElement;for(const n of s)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function ps(s,t){return s.map((r,n)=>s[(t+n)%s.length])}var fs=re,xs=ae,K="Radio",[hs,oe]=V(K),[vs,ys]=hs(K),ie=m.forwardRef((s,t)=>{const{__scopeRadio:r,name:n,checked:u=!1,required:a,disabled:d,value:p="on",onCheck:v,form:x,...l}=s,[h,y]=m.useState(null),i=T(t,o=>y(o)),c=m.useRef(!1),f=h?x||!!h.closest("form"):!0;return e.jsxs(vs,{scope:r,checked:u,disabled:d,children:[e.jsx(I.button,{type:"button",role:"radio","aria-checked":u,"data-state":ue(u),"data-disabled":d?"":void 0,disabled:d,value:p,...l,ref:i,onClick:N(s.onClick,o=>{u||v?.(),f&&(c.current=o.isPropagationStopped(),c.current||o.stopPropagation())})}),f&&e.jsx(de,{control:h,bubbles:!c.current,name:n,value:p,checked:u,required:a,disabled:d,form:x,style:{transform:"translateX(-100%)"}})]})});ie.displayName=K;var ce="RadioIndicator",le=m.forwardRef((s,t)=>{const{__scopeRadio:r,forceMount:n,...u}=s,a=ys(ce,r);return e.jsx(Te,{present:n||a.checked,children:e.jsx(I.span,{"data-state":ue(a.checked),"data-disabled":a.disabled?"":void 0,...u,ref:t})})});le.displayName=ce;var gs="RadioBubbleInput",de=m.forwardRef(({__scopeRadio:s,control:t,checked:r,bubbles:n=!0,...u},a)=>{const d=m.useRef(null),p=T(d,a),v=Xe(r),x=_e(t);return m.useEffect(()=>{const l=d.current;if(!l)return;const h=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(h,"checked").set;if(v!==r&&i){const c=new Event("click",{bubbles:n});i.call(l,r),l.dispatchEvent(c)}},[v,r,n]),e.jsx(I.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...u,tabIndex:-1,ref:p,style:{...u.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});de.displayName=gs;function ue(s){return s?"checked":"unchecked"}var bs=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],_="RadioGroup",[ws]=V(_,[se,oe]),me=se(),pe=oe(),[Ns,js]=ws(_),fe=m.forwardRef((s,t)=>{const{__scopeRadioGroup:r,name:n,defaultValue:u,value:a,required:d=!1,disabled:p=!1,orientation:v,dir:x,loop:l=!0,onValueChange:h,...y}=s,i=me(r),c=Z(x),[f,o]=W({prop:a,defaultProp:u??null,onChange:h,caller:_});return e.jsx(Ns,{scope:r,name:n,required:d,disabled:p,value:f,onValueChange:o,children:e.jsx(fs,{asChild:!0,...i,orientation:v,dir:c,loop:l,children:e.jsx(I.div,{role:"radiogroup","aria-required":d,"aria-orientation":v,"data-disabled":p?"":void 0,dir:c,...y,ref:t})})})});fe.displayName=_;var xe="RadioGroupItem",he=m.forwardRef((s,t)=>{const{__scopeRadioGroup:r,disabled:n,...u}=s,a=js(xe,r),d=a.disabled||n,p=me(r),v=pe(r),x=m.useRef(null),l=T(t,x),h=a.value===u.value,y=m.useRef(!1);return m.useEffect(()=>{const i=f=>{bs.includes(f.key)&&(y.current=!0)},c=()=>y.current=!1;return document.addEventListener("keydown",i),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",i),document.removeEventListener("keyup",c)}},[]),e.jsx(xs,{asChild:!0,...p,focusable:!d,active:h,children:e.jsx(ie,{disabled:d,required:a.required,checked:h,...v,...u,name:a.name,ref:l,onCheck:()=>a.onValueChange(u.value),onKeyDown:N(i=>{i.key==="Enter"&&i.preventDefault()}),onFocus:N(u.onFocus,()=>{y.current&&x.current?.click()})})})});he.displayName=xe;var Rs="RadioGroupIndicator",ve=m.forwardRef((s,t)=>{const{__scopeRadioGroup:r,...n}=s,u=pe(r);return e.jsx(le,{...u,...n,ref:t})});ve.displayName=Rs;var Is=fe,Es=he,Ss=ve;function Cs({className:s,...t}){return e.jsx(Is,{"data-slot":"radio-group",className:J("grid gap-3",s),...t})}function As({className:s,...t}){return e.jsx(Es,{"data-slot":"radio-group-item",className:J("text-primary focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:shadow-md aria-invalid:shadow-destructive/50 dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full shadow-sm transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:shadow-md disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Ss,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Ze,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function Fs({question:s,value:t,onChange:r,error:n}){const u=()=>{switch(s.type){case C.SHORT_TEXT:return e.jsx(B,{value:t||"",onChange:a=>r(a.target.value),placeholder:"Enter your answer",className:n?"border-destructive":""});case C.LONG_TEXT:return e.jsx(He,{value:t||"",onChange:a=>r(a.target.value),placeholder:"Enter your answer",rows:4,className:n?"border-destructive":""});case C.MULTIPLE_CHOICE:return e.jsx(Cs,{value:Array.isArray(t)?t[0]:t||"",onValueChange:a=>r(a),className:n?"border-destructive":"",children:s.options?.map((a,d)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{value:a,id:`${s.id}-${d}`}),e.jsx(E,{htmlFor:`${s.id}-${d}`,className:"font-normal cursor-pointer",children:a})]},d))});case C.RATING_SCALE:return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"1 (Lowest)"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",onClick:()=>r(a),className:`w-10 h-10 rounded-md border-2 transition-colors ${t===a?"bg-primary text-primary-foreground border-primary":"bg-background border-input hover:bg-accent"}`,children:a},a))}),e.jsx("span",{className:"text-sm text-gray-500",children:"5 (Highest)"})]});default:return null}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:s.id,className:"block",children:[s.text,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),u(),n&&e.jsx("p",{className:"text-sm text-destructive",children:n})]})}function qs(){const{formik:s,survey:t,isLoading:r,hasSubmitted:n,handleAnswerChange:u,getAnswerValue:a}=ts(),{values:d,errors:p,touched:v,isSubmitting:x}=s;if(r)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"w-8 h-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading survey..."})]})});if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Survey Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The survey you're looking for doesn't exist or has been removed."})]})});const l=new Date,h=new Date(t.openDate),y=new Date(t.closeDate),i=l>=h&&l<=y;return t.status!==ke.PUBLISHED?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Survey Not Available"}),e.jsxs("p",{className:"text-gray-600",children:["This survey is ",t.status," and not currently accepting responses."]})]})}):i?n?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx(A,{className:"max-w-md w-full",children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(We,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Thank You!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Your response has been submitted successfully."}),e.jsx("p",{className:"text-sm text-gray-500",children:"We appreciate your feedback."})]})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-3xl mx-auto px-4",children:e.jsxs(A,{children:[e.jsxs(De,{children:[e.jsx(Pe,{className:"text-2xl",children:t.title}),e.jsx("p",{className:"text-gray-600 mt-2",children:t.purpose})]}),e.jsx(F,{children:e.jsx(Be,{value:s,children:e.jsxs(Ue,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-6",children:t.questions.map((c,f)=>e.jsx(A,{className:"bg-white",children:e.jsx(F,{className:"pt-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500 leading-none shrink-0",children:["Q",f+1,"."]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(Fs,{question:c,value:a(c.id),onChange:o=>u(c.id,o),error:Array.isArray(p.answers)&&s.values.answers.findIndex(o=>o.questionId===c.id)>=0&&p.answers[s.values.answers.findIndex(o=>o.questionId===c.id)]?.value||void 0})})]})})})},c.id))}),e.jsx(A,{className:"bg-gray-50",children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{id:"anonymous",checked:d.anonymous,onCheckedChange:c=>s.setFieldValue("anonymous",c===!0)}),e.jsx(E,{htmlFor:"anonymous",className:"font-normal cursor-pointer",children:"Submit anonymously"}),e.jsx(ze,{content:"Your name and email will not be associated with your response. You may still need to provide an email to prevent duplicate submissions."})]}),d.anonymous&&e.jsxs("div",{className:"space-y-3 pl-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"respondentName",children:"Name (Optional)"}),e.jsx(B,{id:"respondentName",name:"respondentName",value:d.respondentName||"",onChange:s.handleChange,placeholder:"Your name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"respondentEmail",children:["Email ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(B,{id:"respondentEmail",name:"respondentEmail",type:"email",value:d.respondentEmail||"",onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"your.email@example.com",className:p.respondentEmail&&v.respondentEmail?"shadow-md shadow-destructive/50":""}),e.jsx(Ve,{name:"respondentEmail",children:c=>e.jsx("div",{className:"text-sm text-destructive flex items-center gap-1",children:e.jsx("span",{children:c})})})]})]})]})})}),e.jsx("div",{className:"flex items-center justify-end gap-4 pt-4",children:e.jsx(Ge,{type:"submit",disabled:x,size:"lg",className:"min-w-32",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Response"})})]})})})]})})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Survey Not Available"}),e.jsx("p",{className:"text-gray-600",children:l<h?"This survey has not opened yet.":"This survey has closed and is no longer accepting responses."})]})})}export{qs as default};
